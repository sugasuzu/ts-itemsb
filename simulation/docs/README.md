# シミュレーション分析ドキュメント

このディレクトリには、ルールベース取引シミュレーションの分析レポートが含まれています。

## ドキュメント一覧

### 1. OPTIMIZATION_ANALYSIS.md
**v1シミュレーションの問題点分析**

- **作成日**: 2025-10-30
- **内容**:
  - 初期シミュレーション（v1）の5つの重大な問題を特定
  - データリーケージ（ルックアヘッドバイアス）の検証
  - トランザクションコスト欠如の影響分析
  - シグナル重複問題の調査
- **主な発見**:
  - v1は訓練期間とテスト期間が重複（2010-2025）
  - 勝率50% = ランダムと同等
  - シャープレシオ 0.006 ≈ ゼロ
  - 複数シグナルの同時実行（非現実的）
- **結論**: v1は最適化されておらず、結果が誇張されている

### 2. V1_VS_V2_COMPARISON.md
**最適化前後の比較レポート**

- **作成日**: 2025-10-30
- **内容**:
  - v1（バイアスあり）とv2（最適化版）の詳細比較
  - GBPAUDでの実測結果（20ルール使用）
- **結果比較**:

  | 項目 | v1 (バイアス) | v2 (最適化) | 変化 |
  |------|---------------|-------------|------|
  | リターン | +163.619% | +19.614% | -88% |
  | トレード数 | 63,716 | 1,245 | -98% |
  | 最大DD | -97.556% | -13.756% | +86% |

- **v2の改善点**:
  1. 時間分割（テスト: 2021-2025のみ）
  2. トランザクションコスト: 0.04%/トレード
  3. シグナル重複排除（サポート数優先）

### 3. WALKFORWARD_PORTFOLIO_PLAN.md
**Phase 1-3 実装計画**

- **作成日**: 2025-10-30
- **内容**:
  - ウォークフォワード分析の設計
  - ポートフォリオシミュレーションの設計
  - 統合分析の計画
- **実装フェーズ**:
  - **Phase 1**: ウォークフォワード分析 ✓ 完了
  - **Phase 2**: ポートフォリオシミュレーション ✓ 完了
  - **Phase 3**: 統合分析（ウォークフォワード × ポートフォリオ）⏳ 未実施
- **設計仕様**:
  - 訓練期間: 5年
  - テスト期間: 1年
  - スライディングウィンドウで11期間生成（2015-2025）
  - ポートフォリオ配分戦略: 均等、リスクパリティ、パフォーマンスベース

### 4. PORTFOLIO_ANALYSIS_REPORT.md
**Phase 2 完全レポート（最新）**

- **作成日**: 2025-10-30
- **内容**:
  - 5通貨ペアポートフォリオの包括的分析
  - 個別ペア vs ポートフォリオ比較
  - 相関分析
  - 改善提案
- **テスト構成**:
  - 通貨ペア: GBPAUD, EURAUD, USDJPY, GBPJPY, EURUSD
  - 配分: 均等（各20%）
  - 期間: 2021-01-01 to 2025-10-20
- **主な結果**:
  - ポートフォリオリターン: **+4.32%** ❌
  - 最良単独ペア（EURUSD）: **+25.53%** ✓
  - 最悪単独ペア（USDJPY）: **-36.67%** ❌
  - 平均相関: 0.13（分散効果あり）
- **結論**:
  - 均等配分戦略は失敗
  - USDJPYが全体を破壊（-7.3%の足枷）
  - 相関は低いが、配分方法に問題
- **推奨事項**:
  1. USDJPYを除外 → +14.6%期待
  2. パフォーマンスベース配分に変更
  3. ルール品質でフィルタリング

## 分析の流れ

```
1. 初期シミュレーション（v1）
   ↓
2. 問題点の特定 [OPTIMIZATION_ANALYSIS.md]
   ↓
3. 最適化版（v2）実装
   ↓
4. v1とv2の比較 [V1_VS_V2_COMPARISON.md]
   ↓
5. Phase 1-3計画 [WALKFORWARD_PORTFOLIO_PLAN.md]
   ↓
6. Phase 1: ウォークフォワード実装 ✓
   ↓
7. Phase 2: ポートフォリオ実装 [PORTFOLIO_ANALYSIS_REPORT.md] ✓
   ↓
8. Phase 3: 統合分析 ⏳ 次のステップ
```

## 重要な結論

### v1 → v2最適化の効果
- データリーケージ除去により、リターンが現実的に（+164% → +20%）
- トランザクションコスト導入で収益性を正確に評価
- シグナル重複排除で実行可能性向上

### Phase 1: ウォークフォワード分析
- **GBPAUD**: 72.7%の期間で黒字（一貫性あり）
- 総リターン: +20.5%（11年間）
- 評価: ⚠️ MARGINAL（一貫性はあるが収益性は微妙）

### Phase 2: ポートフォリオシミュレーション
- **均等配分は失敗**: ポートフォリオ+4.3% vs 単独ペア最大+25.5%
- **問題**: 負けペア（USDJPY -36.7%）が全体を破壊
- **解決策**: パフォーマンスベース配分 or USDJPYを除外

## 次のステップ

### 優先度高（即実施可能）
1. **USDJPYなしでポートフォリオ再実行**
   - 期待リターン: +14.6%（+237%改善）

2. **パフォーマンスベース配分のテスト**
   - シャープレシオで重み付け
   - 負けペアに配分しない

3. **リスクパリティ配分のテスト**
   - ボラティリティ逆数で重み付け

### 中期（Phase 3）
4. **ウォークフォワード × ポートフォリオ統合**
   - ポートフォリオに対してウォークフォワード分析を適用
   - 11期間での一貫性をテスト
   - 時期特有 vs 構造的な問題を判別

## 関連ファイル

### Pythonスクリプト
- `../rule_simulator_v2.py` - 単独ペアシミュレーター（最適化版）
- `../walkforward_analyzer.py` - ウォークフォワード分析
- `../portfolio_simulator.py` - ポートフォリオシミュレーター

### 結果ディレクトリ（gitignore対象）
- `../results_v2/` - v2単独ペア結果
- `../results_walkforward/` - ウォークフォワード結果
- `../../results_portfolio/` - ポートフォリオ結果

## 更新履歴

- 2025-10-30: Phase 2完了、ポートフォリオ分析レポート追加
- 2025-10-30: Phase 1完了、ウォークフォワード分析実装
- 2025-10-30: v2最適化実装、v1比較レポート作成
- 2025-10-30: v1問題点分析レポート作成
