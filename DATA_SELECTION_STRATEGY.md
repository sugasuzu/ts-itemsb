# データ選択戦略：統計的異常発見のために

## 利用可能なデータ

### 1. 仮想通貨（Cryptocurrency）- 時間足データ ✅ 推奨

**データセット:**
- 20銘柄 × 17,482時間（約2年間）
- 期間: 2023-11-06 〜 2025-11-03
- 60次元属性（20銘柄 × 3状態: Up/Stay/Down）

**銘柄:**
BTC, ETH, BNB, XRP, ADA, SOL, DOGE, DOT, MATIC, AVAX, LINK, UNI, ATOM, LTC, ETC, XLM, ALGO, VET, FIL, AAVE

**BTC統計:**
```
μ (mean):     0.0077%
σ (std):      0.5121%
Skewness:    -0.0982  (ほぼ対称)
Kurtosis:     9.8848  (ファットテール: 極端な値が多い)
Range:       -4.92% 〜 +5.08%
```

### 2. 株式（Stock）- 日経225 ✅ 利用可能

**データセット:**
- 220銘柄（日経225構成銘柄）
- 期間: 2000-01-04 〜 現在
- 660次元属性（220銘柄 × 3状態）

**特徴:**
- 長期データ（24年間）
- 多数の銘柄
- セクター多様性

### 3. 為替（FX）

**状況:**
- データファイルが見つからない
- 必要に応じて準備可能

---

## データ選択の判断基準

### 基準1: ボラティリティ（統計的異常の発見しやすさ）

| データ | σ (日次換算) | 評価 | 理由 |
|--------|-------------|------|------|
| **仮想通貨** | **0.51%/時** | ⭐⭐⭐⭐⭐ | 高ボラ → 統計的異常が明確 |
| 株式 | 1-2%/日 | ⭐⭐⭐ | 中程度のボラ |
| FX | 0.3-0.5%/日 | ⭐⭐ | 低ボラ → 異常が不明確 |

**結論:** 仮想通貨が最も統計的異常を発見しやすい

### 基準2: データ量（統計的検定の信頼性）

| データ | レコード数 | 評価 | 理由 |
|--------|-----------|------|------|
| **仮想通貨** | **17,482時間** | ⭐⭐⭐⭐⭐ | 十分な統計的検定力 |
| 株式 | ~6,000日/銘柄 | ⭐⭐⭐⭐ | 良好 |
| FX | 未確認 | ? | - |

**結論:** 仮想通貨が最も豊富なデータ量

### 基準3: Time-Delay機能の有効性

| データ | 頻度 | 遅延の意味 | 評価 |
|--------|-----|-----------|------|
| **仮想通貨** | **時間足** | **1-3時間前のパターン** | ⭐⭐⭐⭐⭐ |
| 株式 | 日足 | 1-3日前のパターン | ⭐⭐⭐⭐ |
| FX | 時間足/日足 | - | ⭐⭐⭐ |

**Time-delayの解釈:**
```
仮想通貨（時間足）:
  t-3 = 3時間前
  t-1 = 1時間前
  → 短期トレンドを捉える

株式（日足）:
  t-3 = 3日前
  t-1 = 1日前
  → 中期トレンドを捉える
```

**結論:** 仮想通貨の時間足は短期パターンに最適

### 基準4: ファットテール（極端な異常の存在）

**BTC Kurtosis = 9.88**
```
正規分布: Kurtosis = 3
BTC:      Kurtosis = 9.88 ← 非常に大きい

意味:
  - 極端な値（±2σ超）が正規分布より多い
  - "ブラックスワン"イベントが頻繁
  - → 統計的異常の発見に最適 ✅
```

---

## 推奨データ選択

### 🏆 第1推奨: BTC（Bitcoin）

**理由:**
1. **市場の代表性** - 仮想通貨市場全体を反映
2. **流動性が最高** - ノイズが少ない
3. **最も研究されている** - 先行研究との比較可能
4. **ファットテール特性** - 統計的異常が豊富

**使用シナリオ:**
```bash
# Conservative設定（推奨）
./main BTC 10

期待結果:
  - ルール数: 500-2000
  - 平均リターン: ±0.5-1.0%
  - 統計的有意性: 1σ以上
```

### 🥈 第2推奨: ETH（Ethereum）

**理由:**
1. **時価総額第2位** - 重要性が高い
2. **技術的背景** - スマートコントラクト基盤
3. **BTCとの相関** - 独自のパターンも存在

**使用シナリオ:**
```bash
# BTCとの比較
./main ETH 10

期待:
  - BTCと異なるパターンを発見
  - クロス検証
```

### 🥉 第3推奨: 複数銘柄の統合分析

**アプローチ1: メジャー通貨のみ**
```bash
# BTC, ETH, BNB（時価総額トップ3）
for coin in BTC ETH BNB; do
  ./main $coin 10
done
```

**アプローチ2: ボラティリティ別**
```bash
# 高ボラ: DOGE, SHIB系
# 中ボラ: BTC, ETH
# 低ボラ: ステーブルコイン連動

# 比較研究
```

---

## データごとの期待される発見

### BTC（Bitcoin）で発見されるパターン例

#### パターン1: モメンタム継続
```
IF BTC_Up(t-1) AND ETH_Up(t-1) AND SOL_Up(t-2)
THEN X(t+1) = +0.8% (市場全体の上昇トレンド)
```

#### パターン2: 平均回帰
```
IF BTC_Down(t-1) < -2σ AND Volume_High(t-0)
THEN X(t+1) = +1.2% (過度な売りからの反発)
```

#### パターン3: アルトコイン連動
```
IF ETH_Up(t-2) AND SOL_Up(t-1) AND MATIC_Up(t-0)
THEN BTC_X(t+1) = +0.6% (アルト上昇後のBTC追随)
```

### ETH（Ethereum）で発見されるパターン例

#### パターン1: ガス価格連動
```
IF Network_Congestion(t-1) AND Transaction_Volume_High(t-0)
THEN X(t+1) = +1.0% (需要増による価格上昇)
```

#### パターン2: DeFi連動
```
IF LINK_Up(t-2) AND UNI_Up(t-1) AND AAVE_Up(t-0)
THEN X(t+1) = +0.9% (DeFi銘柄との連動)
```

---

## 株式データの活用（補完的）

### 日経225の利点

1. **長期データ** (24年間)
   - トレンドの長期検証
   - 景気サイクルの影響

2. **多様なセクター**
   - 製造業、金融、IT、サービス
   - セクターローテーション

3. **日本市場特有の現象**
   - 曜日効果（月曜下落、金曜上昇）
   - 月初・月末効果
   - 年末年始効果

### 推奨銘柄（日経225）

#### トヨタ自動車（7203）
```bash
./main 7203 10

期待パターン:
  - 円安時の上昇
  - 海外市場連動
  - 決算発表前後の変動
```

#### ソフトバンクグループ（9984）
```bash
./main 9984 10

期待パターン:
  - テック株連動
  - 投資先企業の影響
  - 高ボラティリティ
```

---

## データ品質の検証

### BTC データの詳細確認

```python
import pandas as pd
import numpy as np

btc = pd.read_csv('1-deta-enginnering/crypto_data_hourly/BTC.txt')

# 1. 欠損値チェック
print("Missing values:", btc.isnull().sum().sum())

# 2. 時系列の連続性
btc['T'] = pd.to_datetime(btc['T'])
time_diff = btc['T'].diff()
print("Time gaps:", time_diff[time_diff > pd.Timedelta(hours=1)].count())

# 3. 異常値チェック
outliers = btc[(btc['X'] > 3*btc['X'].std()) | (btc['X'] < -3*btc['X'].std())]
print("Outliers (>3σ):", len(outliers), f"({len(outliers)/len(btc)*100:.2f}%)")

# 4. ボラティリティの時間変動
btc['volatility'] = btc['X'].rolling(24).std()
print("Volatility range:", btc['volatility'].min(), "-", btc['volatility'].max())
```

**期待される結果:**
- 欠損値: 0
- 時間ギャップ: 0（連続データ）
- 外れ値: 0.27%（正常）
- ボラティリティ: 0.3-1.5%（変動あり）

---

## 最終推奨

### Phase 1: BTC単独（今週）

```bash
# Conservative設定でテスト
./main BTC 10

目的:
  - Minmean=0.5の効果確認
  - 統計的異常の発見
  - ルール品質の評価
```

### Phase 2: メジャー通貨3種（来週）

```bash
# BTC, ETH, BNB
for coin in BTC ETH BNB; do
  ./main $coin 10
done

目的:
  - パターンの一般性確認
  - 銘柄間の比較
  - クロス検証
```

### Phase 3: 全20銘柄（再来週）

```bash
# 全銘柄でバッチ実行
make run  # Makefile定義済み

目的:
  - 包括的な分析
  - 銘柄特性の把握
  - 論文用データ収集
```

---

## データ選択の判定表

| 目的 | 推奨データ | 理由 |
|------|-----------|------|
| **統計的異常の発見** | **BTC（時間足）** | 高ボラ、ファットテール |
| Time-delay機能の検証 | BTC（時間足） | 短期パターンが明確 |
| 長期トレンド分析 | 日経225（日足） | 24年間のデータ |
| 論文執筆 | BTC + メジャー通貨 | 代表性、再現性 |
| 実用的トレーディング | BTC, ETH | 流動性、取引コスト |
| 方法論の一般性検証 | 全20銘柄 | 多様性、頑健性 |

---

## 結論

### 🎯 今すぐ使うべきデータ: **BTC（Bitcoin）時間足**

**理由:**
1. ✅ 統計的異常が最も発見しやすい（σ=0.51%, Kurtosis=9.88）
2. ✅ データ量が十分（17,482時間）
3. ✅ Time-delay機能に最適（短期パターン）
4. ✅ 研究の代表性が高い
5. ✅ 既にシステムがBTCで検証済み

**次のアクション:**
```bash
# 1. Minmean=0.5に変更
# 2. BTC 10試行実行
./main BTC 10

# 3. 結果を評価
grep "rules extracted" output/doc/zrd01.txt
```

**期待される成果:**
- 統計的に有意なルール: 50-200個
- 平均リターン: ±0.5-1.0%
- 論文化可能性: 高
