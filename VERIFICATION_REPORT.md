# 方向性分離統計 実装検証レポート

## ✅ 検証完了日時
2025-11-07 18:16

## 📊 実行結果サマリー

### コンパイル
- ✅ コンパイル成功（gcc -o main main.c -lm -O2）
- ✅ バイナリサイズ: 90KB
- ✅ エラー・警告なし

### 実行結果
- ✅ 実行時間: 8.27秒
- ✅ データ: BTC（17,482レコード、60属性）
- ✅ 試行回数: 10回
- ✅ 発見ルール数: 19,303個（統合後）
- ✅ 高サポートルール: 16,144個
- ✅ 検証ファイル: 10個生成

### 方向性分離統計の出力
✅ **完全に実装・動作確認済み**

#### 出力された統計項目（各ルール、各時点）
- `X(t+1)_pos_mean` - 上昇時の平均値
- `X(t+1)_neg_mean` - 下落時の平均値
- `X(t+1)_pos_cnt` - 上昇回数
- `X(t+1)_neg_cnt` - 下落回数
- `X(t+1)_win_rate` - 勝率
- `X(t+1)_profit_factor` - 損益比
- （t+2についても同様）

## 📈 実際のルール例

### Rule #1: SOL_Up(t-1) ∧ XLM_Up(t-1)
```
【t+1予測】
  全体: 0.002% ± 0.507%
  上昇時: +0.340% (3,197回)
  下落時: -0.329% (3,257回)
  勝率: 49.5%
  損益比: 1.01
  期待値: 0.495×0.340 - 0.505×0.329 = +0.002% ✓

【t+2予測】
  全体: 0.004% ± 0.516%
  上昇時: +0.341% (3,226回)
  下落時: -0.334% (3,208回)
  勝率: 50.1%
  損益比: 1.02

サポート: 6,535件（43.14%）
```

### Rule #943: DOT_Up(t-3) ∧ AVAX_Up(t-3)
```
【高品質ルール】
  上昇時: +0.388% (107回)
  下落時: -0.263% (80回)
  勝率: 57.2%
  損益比: 1.98 ⭐
  期待値: +0.109%
  サポート: 189件
```

## 🎯 期待値計算の検証

### 手動計算
```
期待値 = win_rate × pos_mean - (1 - win_rate) × |neg_mean|
      = 0.495 × 0.340 - 0.505 × 0.329
      = 0.1683 - 0.1661
      = 0.0022
      = 0.002% ✓
```

### 出力値との一致
- 出力された全体平均: 0.002%
- 手動計算: 0.002%
- **完全一致！**

## 📁 出力ファイル構造

```
1-deta-enginnering/crypto_data_hourly/output/BTC/
├── IA/          10ファイル（分析レポート）
├── IB/          10ファイル（詳細バックアップ、各357KB）
├── IL/          10ファイル（ルールリスト）
├── pool/
│   ├── zrp01a.txt   3.4MB（全ルール詳細・TSV形式）
│   └── zrp01b.txt   4.0KB（要約版・読みやすい形式）
├── doc/
│   └── zrd01.txt    統計情報
├── verification/    10個のCSVファイル
│   ├── rule_001.csv 590KB（ルール#1の全マッチデータ）
│   ├── rule_002.csv 393KB
│   └── ...
└── vis/            （可視化用、今回は未使用）
```

## 🔍 高品質ルールの発見

勝率55%以上、損益比1.2以上、サポート100以上のルール: **10個発見**

ベストルール:
- Rule #943: 勝率57.2%、損益比1.98、期待値+0.109%
- Rule #942: 勝率55.9%、損益比1.90、期待値+0.098%
- Rule #778: 勝率57.4%、損益比1.66、期待値+0.063%

## ✨ 結論

**方向性分離統計は完全に実装され、正常に動作しています。**

### 実装済み機能
1. ✅ 上昇/下落の分離集計
2. ✅ 勝率の計算
3. ✅ 損益比（プロフィットファクター）の計算
4. ✅ 期待値との整合性確認
5. ✅ TSV形式での詳細出力
6. ✅ 読みやすい要約形式出力
7. ✅ 検証用CSV生成（タイムスタンプ付き）

### 活用方法
- トレード戦略: 勝率と損益比からポジションサイズ決定
- リスク管理: 非対称リスクの正確な評価
- バックテスト: 検証CSVで全マッチデータを確認
- 最適化: 高品質ルールの自動抽出

---
**生成日時:** 2025-11-07 18:16
**検証者:** Claude Code
**ステータス:** ✅ 完全検証済み
